{
  "hash": "15d095f321a35dd1225e9ae418aee5d2",
  "result": {
    "markdown": "---\ntitle: \"Importation des données\"\ntitle-block-banner: false\n# description: | \n#  Petite description de cette page.\n# à changer\ndate: \"2022-12-20\"\n# Modifier les détails que vous voulez\nauthor:\n  - name: \"Amélie Levasseur-Raymond\"\n    # Votre site web perso ou github\n    url: https://amelie-lr.github.io/\n    # les champs d'affiliation sont optionnels, vous pouvez les\n    # comment out en ajoutant un # devant.\n    affiliation: FAS1002\n    affiliation-url: https://FAS1002.github.io/A22\n    # changer pour votre propre orcid id\n    # https://orcid.org/ pour vous inscrire.\n    # orcid: 0000-0000-0000-0000\n\n# TRUE == Générer une citation pour cette page précise. Pour enlever, mettre false.\ncitation: true\n# Inclure les références que vous utilisez dans vos rapports. Je conseille Zotero pour construire\n# ce fichier ou de connecter RStudio directement pour pouvoir citer avec @nom-de-reference.\nbibliography: references.bib\n---\n\n::: {.cell}\n\n:::\n\n\n## Téléchargement des données\n\n### Our World in Data - Energy\n\n> Les données proviennent de @owidenergy.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# chemin relatif vers le dossier qui contient les données brutes\nbase_path <- path(\"data\", \"raw\")\n\nurl_energy <- \"https://nyc3.digitaloceanspaces.com/owid-public/data/energy/owid-energy-data.csv\"\n\n# personnaliser le nom du fichier téléchargé en y ajoutant la date du jour\nfname_energy <- paste(today(), \"owid-energy-data.csv\", sep = \"_\")\n# établir le chemin relatif complet de notre fichier personnalisé téléchargé\nfpath_energy <- path(base_path, fname_energy)\n\n# télécharger les données seulement si elles n'ont pas déjà été téléchargées aujourd'hui\n# inspiré de : https://stackoverflow.com/questions/14904983/how-do-i-check-the-existence-of-a-downloaded-file\n# télécharge seulement si le fichier en date du jour n'existe pas en supprimant l'ancienne version\nif (!file.exists(fpath_energy)) {\n    file.remove(paste(base_path, dir(path = base_path, pattern = \"*_owid-energy-data.csv\"), sep = \"/\"))\n    download.file(url = url_energy, \n              destfile = fpath_energy)\n}\n```\n:::\n\n\nLe fichier a été téléchargé ici : **data/raw/2022-12-20_owid-energy-data.csv**\n\n### Gapminder - Life Expectancy at Birth\n\n> Les données proviennent de @gmlifeexpectancy\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# url prise de Download lastest version : Excel file\nurl_life <- \"https://docs.google.com/spreadsheets/d/1RheSon1-q4vFc3AGyupVPH6ptEByE-VtnjOCselU0PE/export?format=xlsx\"\n\n# pour ne pas avoir de demande d'authentification Google\ngs4_deauth()\n\n# date sans le jour (année-mois)\ntoday_month <- paste(year(today()), month(today()), sep = \"-\")\n# personnaliser le nom du fichier téléchargé en y ajoutant la date du jour\nfname_life <- paste(today_month, \"gm-life-expectancy-data.xlsx\", sep = \"_\")\n# établir le chemin relatif complet de notre fichier personnalisé téléchargé\nfpath_life <- path(base_path, fname_life)\n\nif (!file.exists(fpath_life)) {\n    file.remove(paste(base_path, dir(path = base_path, pattern = \"*_gm-life-expectancy-data.xlsx\"), sep = \"/\"))\n    download.file(url = url_life, \n              destfile = fpath_life)\n}\n```\n:::\n\n\nLe fichier a été téléchargé ici : **data/raw/2022-12_gm-life-expectancy-data.xlsx**\n\nNous constatons maintenant que notre dossier contient les fichiers suivants :  \ndata/raw/2022-12-20_owid-energy-data.csv, data/raw/2022-12_gm-life-expectancy-data.xlsx\n\n## Premier coup d'oeil\n\nVoyons d'abord plus en détails ce que nous avons comme données.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_energy <- as_tibble(read_csv(file = fpath_energy))\n\ndata_life <- as_tibble(read_excel(fpath_life, sheet = \"data-for-countries-etc-by-year\", range = NULL, trim_ws = TRUE, col_names = TRUE))\n```\n:::\n\n\n### Énergie\n\n\n::: {.cell}\n\n```{.r .cell-code}\nkable(slice_sample(data_energy, n = 5))\n```\n\n::: {.cell-output-display}\n|country            | year|iso_code | population|          gdp| biofuel_cons_change_pct| biofuel_cons_change_twh| biofuel_cons_per_capita| biofuel_consumption| biofuel_elec_per_capita| biofuel_electricity| biofuel_share_elec| biofuel_share_energy| carbon_intensity_elec| coal_cons_change_pct| coal_cons_change_twh| coal_cons_per_capita| coal_consumption| coal_elec_per_capita| coal_electricity| coal_prod_change_pct| coal_prod_change_twh| coal_prod_per_capita| coal_production| coal_share_elec| coal_share_energy| electricity_demand| electricity_generation| electricity_share_energy| energy_cons_change_pct| energy_cons_change_twh| energy_per_capita| energy_per_gdp| fossil_cons_change_pct| fossil_cons_change_twh| fossil_elec_per_capita| fossil_electricity| fossil_energy_per_capita| fossil_fuel_consumption| fossil_share_elec| fossil_share_energy| gas_cons_change_pct| gas_cons_change_twh| gas_consumption| gas_elec_per_capita| gas_electricity| gas_energy_per_capita| gas_prod_change_pct| gas_prod_change_twh| gas_prod_per_capita| gas_production| gas_share_elec| gas_share_energy| greenhouse_gas_emissions| hydro_cons_change_pct| hydro_cons_change_twh| hydro_consumption| hydro_elec_per_capita| hydro_electricity| hydro_energy_per_capita| hydro_share_elec| hydro_share_energy| low_carbon_cons_change_pct| low_carbon_cons_change_twh| low_carbon_consumption| low_carbon_elec_per_capita| low_carbon_electricity| low_carbon_energy_per_capita| low_carbon_share_elec| low_carbon_share_energy| net_elec_imports| net_elec_imports_share_demand| nuclear_cons_change_pct| nuclear_cons_change_twh| nuclear_consumption| nuclear_elec_per_capita| nuclear_electricity| nuclear_energy_per_capita| nuclear_share_elec| nuclear_share_energy| oil_cons_change_pct| oil_cons_change_twh| oil_consumption| oil_elec_per_capita| oil_electricity| oil_energy_per_capita| oil_prod_change_pct| oil_prod_change_twh| oil_prod_per_capita| oil_production| oil_share_elec| oil_share_energy| other_renewable_consumption| other_renewable_electricity| other_renewable_exc_biofuel_electricity| other_renewables_cons_change_pct| other_renewables_cons_change_twh| other_renewables_elec_per_capita| other_renewables_elec_per_capita_exc_biofuel| other_renewables_energy_per_capita| other_renewables_share_elec| other_renewables_share_elec_exc_biofuel| other_renewables_share_energy| per_capita_electricity| primary_energy_consumption| renewables_cons_change_pct| renewables_cons_change_twh| renewables_consumption| renewables_elec_per_capita| renewables_electricity| renewables_energy_per_capita| renewables_share_elec| renewables_share_energy| solar_cons_change_pct| solar_cons_change_twh| solar_consumption| solar_elec_per_capita| solar_electricity| solar_energy_per_capita| solar_share_elec| solar_share_energy| wind_cons_change_pct| wind_cons_change_twh| wind_consumption| wind_elec_per_capita| wind_electricity| wind_energy_per_capita| wind_share_elec| wind_share_energy|\n|:------------------|----:|:--------|----------:|------------:|-----------------------:|-----------------------:|-----------------------:|-------------------:|-----------------------:|-------------------:|------------------:|--------------------:|---------------------:|--------------------:|--------------------:|--------------------:|----------------:|--------------------:|----------------:|--------------------:|--------------------:|--------------------:|---------------:|---------------:|-----------------:|------------------:|----------------------:|------------------------:|----------------------:|----------------------:|-----------------:|--------------:|----------------------:|----------------------:|----------------------:|------------------:|------------------------:|-----------------------:|-----------------:|-------------------:|-------------------:|-------------------:|---------------:|-------------------:|---------------:|---------------------:|-------------------:|-------------------:|-------------------:|--------------:|--------------:|----------------:|------------------------:|---------------------:|---------------------:|-----------------:|---------------------:|-----------------:|-----------------------:|----------------:|------------------:|--------------------------:|--------------------------:|----------------------:|--------------------------:|----------------------:|----------------------------:|---------------------:|-----------------------:|----------------:|-----------------------------:|-----------------------:|-----------------------:|-------------------:|-----------------------:|-------------------:|-------------------------:|------------------:|--------------------:|-------------------:|-------------------:|---------------:|-------------------:|---------------:|---------------------:|-------------------:|-------------------:|-------------------:|--------------:|--------------:|----------------:|---------------------------:|---------------------------:|---------------------------------------:|--------------------------------:|--------------------------------:|--------------------------------:|--------------------------------------------:|----------------------------------:|---------------------------:|---------------------------------------:|-----------------------------:|----------------------:|--------------------------:|--------------------------:|--------------------------:|----------------------:|--------------------------:|----------------------:|----------------------------:|---------------------:|-----------------------:|---------------------:|---------------------:|-----------------:|---------------------:|-----------------:|-----------------------:|----------------:|------------------:|--------------------:|--------------------:|----------------:|--------------------:|----------------:|----------------------:|---------------:|-----------------:|\n|Colombia           | 1933|COL      |    8502496|  20617314304|                      NA|                      NA|                      NA|                  NA|                      NA|                  NA|                 NA|                   NA|                    NA|                   NA|                   NA|                   NA|               NA|                   NA|               NA|                   NA|                0.733|               86.174|           0.733|              NA|                NA|                 NA|                     NA|                       NA|                     NA|                     NA|                NA|             NA|                     NA|                     NA|                     NA|                 NA|                       NA|                      NA|                NA|                  NA|                  NA|                  NA|              NA|                  NA|              NA|                    NA|                  NA|               0.000|                   0|           0.00|             NA|               NA|                       NA|                    NA|                    NA|                NA|                    NA|                NA|                      NA|               NA|                 NA|                         NA|                         NA|                     NA|                         NA|                     NA|                           NA|                    NA|                      NA|               NA|                            NA|                      NA|                      NA|                  NA|                      NA|                  NA|                        NA|                 NA|                   NA|                  NA|                  NA|              NA|                  NA|              NA|                    NA|             -19.893|              -5.175|            2451.158|         20.841|             NA|               NA|                          NA|                          NA|                                      NA|                               NA|                               NA|                               NA|                                           NA|                                 NA|                          NA|                                      NA|                            NA|                     NA|                         NA|                         NA|                         NA|                     NA|                         NA|                     NA|                           NA|                    NA|                      NA|                    NA|                    NA|                NA|                    NA|                NA|                      NA|               NA|                 NA|                   NA|                   NA|               NA|                   NA|               NA|                     NA|              NA|                NA|\n|South Korea        | 1997|KOR      |   45962392| 967604961280|                      NA|                       0|                       0|                   0|                      NA|                  NA|                 NA|                    0|                    NA|                8.808|               32.883|             8837.783|          406.206|             1998.841|           91.871|               -8.867|               -2.298|              513.758|          23.614|          37.257|            19.061|                 NA|                246.587|                   11.571|                  9.827|                190.688|         46366.664|          2.202|                 10.545|                181.601|                3524.62|                162|                 41421.02|                1903.809|            65.697|              89.334|              21.525|              27.424|         154.828|             913.841|          42.002|              3368.577|                  NA|               0.000|                   0|           0.00|         17.033|            7.265|                       NA|                16.072|                 1.152|             8.321|                61.224|             2.814|                 181.038|            1.141|               0.39|                      4.204|                      9.088|                227.313|                   1740.154|                 79.982|                     4945.639|                32.435|                  10.666|               NA|                            NA|                   4.276|                   8.970|             218.732|                1677.146|              77.086|                  4758.927|             31.261|               10.264|               9.930|             121.294|        1342.776|             611.938|          28.126|              29214.66|                  NA|               0.000|               0.000|          0.000|         11.406|           63.008|                       0.249|                       0.078|                                      NA|                          -80.645|                           -1.037|                            1.697|                                           NA|                              5.417|                       0.032|                                      NA|                         0.012|               5364.983|                   2131.123|                      2.319|                      0.118|                  8.582|                     63.008|                  2.896|                      186.712|                 1.174|                   0.403|                     0|                     0|             0.009|                 0.065|             0.003|                   0.193|            0.001|                  0|                   NA|                0.003|            0.003|                0.022|            0.001|                  0.064|               0|                 0|\n|Montserrat         | 1991|MSR      |      10593|           NA|                      NA|                      NA|                      NA|                  NA|                      NA|                  NA|                 NA|                   NA|                    NA|                   NA|                   NA|                   NA|               NA|                   NA|               NA|                   NA|                0.000|                0.000|           0.000|              NA|                NA|                 NA|                     NA|                       NA|                 74.772|                  0.056|         12398.994|             NA|                     NA|                     NA|                     NA|                 NA|                       NA|                      NA|                NA|                  NA|                  NA|                  NA|              NA|                  NA|              NA|                    NA|                  NA|               0.000|                   0|           0.00|             NA|               NA|                       NA|                    NA|                    NA|                NA|                    NA|                NA|                      NA|               NA|                 NA|                         NA|                         NA|                     NA|                         NA|                     NA|                           NA|                    NA|                      NA|               NA|                            NA|                      NA|                      NA|                  NA|                      NA|                  NA|                        NA|                 NA|                   NA|                  NA|                  NA|              NA|                  NA|              NA|                    NA|                  NA|               0.000|               0.000|          0.000|             NA|               NA|                          NA|                          NA|                                      NA|                               NA|                               NA|                               NA|                                           NA|                                 NA|                          NA|                                      NA|                            NA|                     NA|                      0.131|                         NA|                         NA|                     NA|                         NA|                     NA|                           NA|                    NA|                      NA|                    NA|                    NA|                NA|                    NA|                NA|                      NA|               NA|                 NA|                   NA|                   NA|               NA|                   NA|               NA|                     NA|              NA|                NA|\n|North America (BP) | 1972|NA       |         NA|           NA|                      NA|                      NA|                      NA|                  NA|                      NA|                  NA|                 NA|                   NA|                    NA|                3.623|              124.329|                   NA|         3556.365|                   NA|               NA|                   NA|                   NA|                   NA|              NA|              NA|            16.123|                 NA|                     NA|                       NA|                  5.334|               1116.951|                NA|             NA|                  5.022|                975.869|                     NA|                 NA|                       NA|               20409.662|                NA|              92.528|               1.777|             113.752|        6513.539|                  NA|              NA|                    NA|               0.934|              61.442|                  NA|        6637.78|             NA|           29.529|                       NA|                 5.920|                78.653|          1407.190|                    NA|           475.886|                      NA|               NA|               6.38|                      9.497|                    141.080|               1648.270|                         NA|                558.708|                           NA|                    NA|                   7.472|               NA|                            NA|                  44.555|                  56.103|             182.024|                      NA|              64.149|                        NA|                 NA|                0.825|               7.684|             737.788|       10339.759|                  NA|              NA|                    NA|               2.326|             169.097|                  NA|       7439.695|             NA|           46.875|                      59.056|                      18.673|                                      NA|                           12.594|                            6.323|                               NA|                                           NA|                                 NA|                          NA|                                      NA|                         0.268|                     NA|                  22057.934|                      6.158|                     84.976|               1466.246|                         NA|                494.559|                           NA|                    NA|                   6.647|                    NA|                     0|             0.000|                    NA|             0.000|                      NA|               NA|                  0|                   NA|                0.000|            0.000|                   NA|            0.000|                     NA|              NA|                 0|\n|Liberia            | 1988|LBR      |    2439645|   7312739840|                      NA|                      NA|                      NA|                  NA|                      NA|                  NA|                 NA|                   NA|                    NA|                   NA|                   NA|                   NA|               NA|                   NA|               NA|                   NA|                0.000|                0.000|           0.000|              NA|                NA|                 NA|                     NA|                       NA|                 24.469|                  1.174|          2448.677|          0.817|                     NA|                     NA|                     NA|                 NA|                       NA|                      NA|                NA|                  NA|                  NA|                  NA|              NA|                  NA|              NA|                    NA|                  NA|               0.000|                   0|           0.00|             NA|               NA|                       NA|                    NA|                    NA|                NA|                    NA|                NA|                      NA|               NA|                 NA|                         NA|                         NA|                     NA|                         NA|                     NA|                           NA|                    NA|                      NA|               NA|                            NA|                      NA|                      NA|                  NA|                      NA|                  NA|                        NA|                 NA|                   NA|                  NA|                  NA|              NA|                  NA|              NA|                    NA|                  NA|               0.000|               0.000|          0.000|             NA|               NA|                          NA|                          NA|                                      NA|                               NA|                               NA|                               NA|                                           NA|                                 NA|                          NA|                                      NA|                            NA|                     NA|                      5.974|                         NA|                         NA|                     NA|                         NA|                     NA|                           NA|                    NA|                      NA|                    NA|                    NA|                NA|                    NA|                NA|                      NA|               NA|                 NA|                   NA|                   NA|               NA|                   NA|               NA|                     NA|              NA|                NA|\n:::\n:::\n\n\nPremière question à se poser : Utiliserons-nous toutes ces variables?  \nSûrement pas, d'autant plus qu'il semble y avoir beaucoup d'informations manquantes. Nous y reviendrons...\n\n### Espérance de vie\n\n\n::: {.cell}\n\n```{.r .cell-code}\nkable(slice_sample(data_life, n = 5))\n```\n\n::: {.cell-output-display}\n|geo |name       | time| Life expectancy|\n|:---|:----------|----:|---------------:|\n|eri |Eritrea    | 1822|           30.20|\n|mdv |Maldives   | 1828|           32.65|\n|isr |Israel     | 2069|           88.97|\n|tjk |Tajikistan | 2017|           68.75|\n|col |Colombia   | 1877|           32.33|\n:::\n:::\n\n\n\n\n## Nettoyage des données\n\nÀ première vue, les données semblent être bien arrangées et *tidy*. Rien de trop grave ne saute aux yeux. Uniformisons cependant les noms des colonnes entre les deux jeux de données en les nettoyant un peu par le fait même.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# renommer les titres de colonnes de data_life pour concorder avec ceux de data_energy\ndata_life_clean <- data_life %>%\n    dplyr::rename(life_expectancy = `Life expectancy`,\n                  year = `time`,\n                  country = `name`,\n                  iso_code = `geo`)\n```\n:::\n\n\nLes codes ISO des pays devraient aussi être uniformisés pour les avoir en majuscules dans les deux jeux.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# convertir les codes ISO du jeux data_life pour qu'ils soient en majuscules\n# inspiré de : https://stackoverflow.com/questions/16516593/convert-from-lowercase-to-uppercase-all-values-in-all-character-variables-in-dat\ndata_life_clean$iso_code <- toupper(data_life_clean$iso_code)\n```\n:::\n\n\nNous nous retrouvons maintenant avec les noms de colonnes suivants dans le jeu *Life Expectancy at Birth* : iso_code, country, year, life_expectancy\n\n## Manipulations\n\nNous ne conserverons que les variables qui nous intéressent du jeux Energy. Nous nous attarderons donc seulement à l'énergie **consommée**.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_energy_cons <- data_energy %>%\n    select(iso_code,\n           country,\n           year,\n           population,\n           contains(\"cons\")\n           )\n\nkable(slice_sample(data_energy_cons, n = 5))\n```\n\n::: {.cell-output-display}\n|iso_code |country   | year| population| biofuel_cons_change_pct| biofuel_cons_change_twh| biofuel_cons_per_capita| biofuel_consumption| coal_cons_change_pct| coal_cons_change_twh| coal_cons_per_capita| coal_consumption| energy_cons_change_pct| energy_cons_change_twh| fossil_cons_change_pct| fossil_cons_change_twh| fossil_fuel_consumption| gas_cons_change_pct| gas_cons_change_twh| gas_consumption| hydro_cons_change_pct| hydro_cons_change_twh| hydro_consumption| low_carbon_cons_change_pct| low_carbon_cons_change_twh| low_carbon_consumption| nuclear_cons_change_pct| nuclear_cons_change_twh| nuclear_consumption| oil_cons_change_pct| oil_cons_change_twh| oil_consumption| other_renewable_consumption| other_renewables_cons_change_pct| other_renewables_cons_change_twh| primary_energy_consumption| renewables_cons_change_pct| renewables_cons_change_twh| renewables_consumption| solar_cons_change_pct| solar_cons_change_twh| solar_consumption| wind_cons_change_pct| wind_cons_change_twh| wind_consumption|\n|:--------|:---------|----:|----------:|-----------------------:|-----------------------:|-----------------------:|-------------------:|--------------------:|--------------------:|--------------------:|----------------:|----------------------:|----------------------:|----------------------:|----------------------:|-----------------------:|-------------------:|-------------------:|---------------:|---------------------:|---------------------:|-----------------:|--------------------------:|--------------------------:|----------------------:|-----------------------:|-----------------------:|-------------------:|-------------------:|-------------------:|---------------:|---------------------------:|--------------------------------:|--------------------------------:|--------------------------:|--------------------------:|--------------------------:|----------------------:|---------------------:|---------------------:|-----------------:|--------------------:|--------------------:|----------------:|\n|NA       |World     | 1927| 2044254070|                      NA|                      NA|                      NA|                  NA|                   NA|                   NA|                   NA|               NA|                     NA|                     NA|                     NA|                     NA|                      NA|                  NA|                  NA|              NA|                    NA|                    NA|                NA|                         NA|                         NA|                     NA|                      NA|                      NA|                  NA|                  NA|                  NA|              NA|                          NA|                               NA|                               NA|                         NA|                         NA|                         NA|                     NA|                    NA|                    NA|                NA|                   NA|                   NA|               NA|\n|NA       |Europe    | 2007|  732469869|                      NA|                      NA|                      NA|                  NA|               -0.172|               -9.614|             7624.636|         5584.816|                 -0.791|               -259.645|                 -0.943|               -253.141|                26584.81|              -0.294|             -30.388|        10317.61|                 2.053|                27.826|          1994.021|                     -0.025|                    -28.361|               5918.752|                  -3.846|                -153.548|             3299.11|              -1.956|             -213.14|        10682.38|                     314.466|                           11.231|                           31.545|                  32580.836|                      5.547|                    125.187|               2619.642|                50.937|                 3.655|            10.965|               26.908|               62.162|          300.191|\n|MNG      |Mongolia  | 1966|    1165753|                      NA|                      NA|                      NA|                  NA|                   NA|                   NA|                   NA|               NA|                     NA|                     NA|                     NA|                     NA|                      NA|                  NA|                  NA|              NA|                    NA|                    NA|                NA|                         NA|                         NA|                     NA|                      NA|                      NA|                  NA|                  NA|                  NA|              NA|                          NA|                               NA|                               NA|                         NA|                         NA|                         NA|                     NA|                    NA|                    NA|                NA|                   NA|                   NA|               NA|\n|PSE      |Palestine | 2015|    4484615|                      NA|                      NA|                      NA|                  NA|                   NA|                   NA|                   NA|               NA|                 10.925|                  1.802|                     NA|                     NA|                      NA|                  NA|                  NA|              NA|                    NA|                    NA|                NA|                         NA|                         NA|                     NA|                      NA|                      NA|                  NA|                  NA|                  NA|              NA|                          NA|                               NA|                               NA|                     18.298|                         NA|                         NA|                     NA|                    NA|                    NA|                NA|                   NA|                   NA|               NA|\n|NA       |Africa    | 1945|  209026260|                      NA|                      NA|                      NA|                  NA|                   NA|                   NA|                   NA|               NA|                     NA|                     NA|                     NA|                     NA|                      NA|                  NA|                  NA|              NA|                    NA|                    NA|                NA|                         NA|                         NA|                     NA|                      NA|                      NA|                  NA|                  NA|                  NA|              NA|                          NA|                               NA|                               NA|                         NA|                         NA|                         NA|                     NA|                    NA|                    NA|                NA|                   NA|                   NA|               NA|\n:::\n:::\n\n\nDéjà beaucoup mieux, nous sommes passé de 129 à 45 variables. \nMais il y encore encore beaucoup de bruit, réduisons encore un peu plus.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_energy_cons <- data_energy_cons %>%\n    select(iso_code,\n           country,\n           year,\n           population,\n           contains(\"consumption\")\n           )\n\nkable(slice_sample(data_energy_cons, n = 5))\n```\n\n::: {.cell-output-display}\n|iso_code |country              | year| population| biofuel_consumption| coal_consumption| fossil_fuel_consumption| gas_consumption| hydro_consumption| low_carbon_consumption| nuclear_consumption| oil_consumption| other_renewable_consumption| primary_energy_consumption| renewables_consumption| solar_consumption| wind_consumption|\n|:--------|:--------------------|----:|----------:|-------------------:|----------------:|-----------------------:|---------------:|-----------------:|----------------------:|-------------------:|---------------:|---------------------------:|--------------------------:|----------------------:|-----------------:|----------------:|\n|ANT      |Netherlands Antilles | 1997|         NA|                  NA|               NA|                      NA|              NA|                NA|                     NA|                  NA|              NA|                          NA|                     46.818|                     NA|                NA|               NA|\n|PYF      |French Polynesia     | 1996|     235200|                  NA|               NA|                      NA|              NA|                NA|                     NA|                  NA|              NA|                          NA|                      3.274|                     NA|                NA|               NA|\n|AFG      |Afghanistan          | 2016|   34636212|                  NA|               NA|                      NA|              NA|                NA|                     NA|                  NA|              NA|                          NA|                     34.458|                     NA|                NA|               NA|\n|KHM      |Cambodia             | 1994|   10636353|                  NA|               NA|                      NA|              NA|                NA|                     NA|                  NA|              NA|                          NA|                      2.186|                     NA|                NA|               NA|\n|THA      |Thailand             | 1923|   10824701|                  NA|               NA|                      NA|              NA|                NA|                     NA|                  NA|              NA|                          NA|                         NA|                     NA|                NA|               NA|\n:::\n:::\n\n\nNous ajouterons aussi une variable *primary_energy_cons_per_capita*.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# inspiré de : https://stackoverflow.com/questions/27354734/dplyr-mutate-rowsums-calculations-or-custom-functions\n# data_energy_cons <- data_energy_cons %>%\n#     mutate(total_consumption = rowSums(across(biofuel_consumption:wind_consumption), \n#                                        na.rm = TRUE))\n\n# data_energy_cons$total_consumption[data_energy_cons$total_consumption == 0.000] <- NA\n\ndata_energy_cons <- data_energy_cons %>%\n    mutate(primary_energy_cons_per_capita = primary_energy_consumption / population)\n\nkable(slice_sample(data_energy_cons, n = 5))\n```\n\n::: {.cell-output-display}\n|iso_code |country                       | year| population| biofuel_consumption| coal_consumption| fossil_fuel_consumption| gas_consumption| hydro_consumption| low_carbon_consumption| nuclear_consumption| oil_consumption| other_renewable_consumption| primary_energy_consumption| renewables_consumption| solar_consumption| wind_consumption| primary_energy_cons_per_capita|\n|:--------|:-----------------------------|----:|----------:|-------------------:|----------------:|-----------------------:|---------------:|-----------------:|----------------------:|-------------------:|---------------:|---------------------------:|--------------------------:|----------------------:|-----------------:|----------------:|------------------------------:|\n|NA       |Wake Island (Shift)           | 1982|         NA|                  NA|               NA|                      NA|              NA|                NA|                     NA|                  NA|              NA|                          NA|                         NA|                     NA|                NA|               NA|                             NA|\n|MTQ      |Martinique                    | 1994|     402801|                  NA|               NA|                      NA|              NA|                NA|                     NA|                  NA|              NA|                          NA|                      7.914|                     NA|                NA|               NA|                       1.96e-05|\n|GBR      |United Kingdom                | 1935|   47475729|                  NA|               NA|                      NA|              NA|                NA|                     NA|                  NA|              NA|                          NA|                         NA|                     NA|                NA|               NA|                             NA|\n|NA       |OECD - Asia And Oceania (EIA) | 1985|         NA|                  NA|               NA|                      NA|              NA|                NA|                     NA|                  NA|              NA|                          NA|                   6542.833|                     NA|                NA|               NA|                             NA|\n|NA       |OPEC (Shift)                  | 1952|         NA|                  NA|               NA|                      NA|              NA|                NA|                     NA|                  NA|              NA|                          NA|                         NA|                     NA|                NA|               NA|                             NA|\n:::\n:::\n\n\n\n### Ajout d'une variable *continents*\n\n> Pour ce faire, nous utiliserons le package de @countrycodepack\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_energy_cons_clean <- data_energy_cons %>%\n    mutate(countrycode(data_energy_cons$iso_code, origin = \"iso3c\", destination = \"continent\", custom_match = c( ATA = 'Antartica', ANT = 'Americas')), .before = 1) %>%\n    rename(continent = `countrycode(...)`)\n\nkable(slice_sample(data_energy_cons_clean, n = 10))\n```\n\n::: {.cell-output-display}\n|continent |iso_code |country                        | year| population| biofuel_consumption| coal_consumption| fossil_fuel_consumption| gas_consumption| hydro_consumption| low_carbon_consumption| nuclear_consumption| oil_consumption| other_renewable_consumption| primary_energy_consumption| renewables_consumption| solar_consumption| wind_consumption| primary_energy_cons_per_capita|\n|:---------|:--------|:------------------------------|----:|----------:|-------------------:|----------------:|-----------------------:|---------------:|-----------------:|----------------------:|-------------------:|---------------:|---------------------------:|--------------------------:|----------------------:|-----------------:|----------------:|------------------------------:|\n|Americas  |TTO      |Trinidad and Tobago            | 1905|     303007|                  NA|               NA|                      NA|              NA|                NA|                     NA|                  NA|              NA|                          NA|                         NA|                     NA|                NA|               NA|                             NA|\n|NA        |NA       |Yugoslavia                     | 1952|   16073794|                  NA|               NA|                      NA|              NA|                NA|                     NA|                  NA|              NA|                          NA|                         NA|                     NA|                NA|               NA|                             NA|\n|NA        |NA       |Total Non-OPEC (BP)            | 2000|         NA|                  NA|               NA|                      NA|              NA|                NA|                     NA|                  NA|              NA|                          NA|                         NA|                     NA|                NA|               NA|                             NA|\n|Africa    |CIV      |Cote d'Ivoire                  | 1953|    2976276|                  NA|               NA|                      NA|              NA|                NA|                     NA|                  NA|              NA|                          NA|                         NA|                     NA|                NA|               NA|                             NA|\n|NA        |NA       |Africa (BP)                    | 1991|         NA|               0.000|          853.762|                2404.103|         401.636|           179.346|                207.779|              25.946|        1148.705|                       2.487|                   2611.882|                181.833|                 0|                0|                             NA|\n|NA        |NA       |IEO OECD - Europe (EIA)        | 2007|         NA|                  NA|               NA|                      NA|              NA|                NA|                     NA|                  NA|              NA|                          NA|                  24410.725|                     NA|                NA|               NA|                             NA|\n|Americas  |MEX      |Mexico                         | 1974|   56945880|                  NA|           20.562|                 506.962|         129.147|            49.405|                 50.719|               0.000|         357.252|                       1.314|                    557.681|                 50.719|                 0|                0|                        9.8e-06|\n|Americas  |CAN      |Canada                         | 1935|   10793390|                  NA|               NA|                      NA|              NA|                NA|                     NA|                  NA|              NA|                          NA|                         NA|                     NA|                NA|               NA|                             NA|\n|Asia      |NPL      |Nepal                          | 1990|   19616528|                  NA|               NA|                      NA|              NA|                NA|                     NA|                  NA|              NA|                          NA|                      5.545|                     NA|                NA|               NA|                        3.0e-07|\n|NA        |NA       |South and Central America (BP) | 1986|         NA|              79.678|          185.604|                2594.624|         509.400|           904.861|               1020.935|              16.614|        1899.621|                      19.783|                   3615.559|               1004.321|                 0|                0|                             NA|\n:::\n:::\n\n\nUn message nous mentionne que deux codes ISO de pays n'ont pas trouvé d'équivalent, nous avons donc dû les ajouter manuellement dans la commande.\n\nAprès une analyse un peu plus poussée du jeu de données, nous constatons que la variable *country* correspond parfois à un pays et d'autres, à un continent ou région. Il serait donc préférable d'éliminer ces observations du jeu maintenant que nous avons ajouté la variable *continent*. \n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_energy_cons_clean <- data_energy_cons_clean %>%\n    filter(!is.na(continent))\n```\n:::\n\n\nLes pays sont donc maintenant associés aux continents suivants dans notre jeu de données :  \nAsia, Europe, Africa, Oceania, Antartica, Americas\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# html <- \"\"\n# \n# data_continents <- read_html(x = html) %>%\n#     html_element(css = \".data-table\") #%>% \n#     #html_table()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# quelques info utiles sur le fichier\n#file.info(fpath_energy)\n\n# paste avec le file.path quand on ouvre\n```\n:::\n\n\n\n\n\n\n\n## Sauvegarde de nos jeux de données nettoyés\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_csv(data_energy_cons_clean, file = \"data/processed/owid-energy-consumption-data.csv\")\nwrite_csv(data_life_clean, file = \"data/processed/gm-life-expectancy-data.csv\")\n```\n:::\n\n\nNous voilà maintenant avec nos deux jeux de données nettoyés que nous pourrons réutiliser :  \ndata/processed/data_package.zip, data/processed/gm-life-expectancy-data.csv, data/processed/owid-energy-consumption-data.csv\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}