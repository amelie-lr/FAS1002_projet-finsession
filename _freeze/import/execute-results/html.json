{
  "hash": "91e4fa067aabc6c8ae6725ac8580b504",
  "result": {
    "markdown": "---\ntitle: \"Importation des données\"\ntitle-block-banner: false\ndescription: | \n  Petite description de cette page.\n# à changer\ndate: \"2022-12-21\"\n# Modifier les détails que vous voulez\nauthor:\n  - name: \"Amélie Levasseur-Raymond\"\n    # Votre site web perso ou github\n    url: https://amelie-lr.github.io/\n    # les champs d'affiliation sont optionnels, vous pouvez les\n    # comment out en ajoutant un # devant.\n    affiliation: FAS1002\n    affiliation-url: https://FAS1002.github.io/A22\n    # changer pour votre propre orcid id\n    # https://orcid.org/ pour vous inscrire.\n    # orcid: 0000-0000-0000-0000\n\n# TRUE == Générer une citation pour cette page précise. Pour enlever, mettre false.\ncitation: true\n# Inclure les références que vous utilisez dans vos rapports. Je conseille Zotero pour construire\n# ce fichier ou de connecter RStudio directement pour pouvoir citer avec @nom-de-reference.\nbibliography: references.bib\n---\n\n\n\n::: callout-important\nN'oubliez pas d'inclure vos références sur chacune des pages!\n:::\n\n\n\n::: {.cell}\n\n:::\n\n\n## Téléchargement des données\n\n### Our World in Data - Energy\n\n> Les données proviennent de @owidenergy.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# chemin relatif vers le dossier qui contient les données brutes\nbase_path <- path(\"data\", \"raw\")\n\nurl_energy <- \"https://nyc3.digitaloceanspaces.com/owid-public/data/energy/owid-energy-data.csv\"\n\n# personnaliser le nom du fichier téléchargé en y ajoutant la date du jour\nfname_energy <- paste(today(), \"owid-energy-data.csv\", sep = \"_\")\n# établir le chemin relatif complet de notre fichier personnalisé téléchargé\nfpath_energy <- path(base_path, fname_energy)\n\n# télécharger les données seulement si elles n'ont pas déjà été téléchargées aujourd'hui\n# inspiré de : https://stackoverflow.com/questions/14904983/how-do-i-check-the-existence-of-a-downloaded-file\n# télécharge seulement si le fichier en date du jour n'existe pas en supprimant l'ancienne version\nif (!file.exists(fpath_energy)) {\n    file.remove(paste(base_path, dir(path = base_path, pattern = \"*_owid-energy-data.csv\"), sep = \"/\"))\n    download.file(url = url_energy, \n              destfile = fpath_energy)\n}\n```\n:::\n\n\nLe fichier a été téléchargé ici : **data/raw/2022-12-18_owid-energy-data.csv**\n\n### Gapminder - Life Expectancy at Birth\n\n> Les données proviennent de @gmlifeexpectancy\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# url prise de Download lastest version : Excel file\nurl_life <- \"https://docs.google.com/spreadsheets/d/1RheSon1-q4vFc3AGyupVPH6ptEByE-VtnjOCselU0PE/export?format=xlsx\"\n\n# pour ne pas avoir de demande d'authentification Google\ngs4_deauth()\n\n# date sans le jour (année-mois)\ntoday_month <- paste(year(today()), month(today()), sep = \"-\")\n# personnaliser le nom du fichier téléchargé en y ajoutant la date du jour\nfname_life <- paste(today_month, \"gm-life-expectancy-data.xlsx\", sep = \"_\")\n# établir le chemin relatif complet de notre fichier personnalisé téléchargé\nfpath_life <- path(base_path, fname_life)\n\nif (!file.exists(fpath_life)) {\n    file.remove(paste(base_path, dir(path = base_path, pattern = \"*_gm-life-expectancy-data.xlsx\"), sep = \"/\"))\n    download.file(url = url_life, \n              destfile = fpath_life)\n}\n```\n:::\n\n\nLe fichier a été téléchargé ici : **data/raw/2022-12_gm-life-expectancy-data.xlsx**\n\nNous constatons maintenant que notre dossier contient les fichiers suivants :  \ndata/raw/2022-12-18_owid-energy-data.csv, data/raw/2022-12_gm-life-expectancy-data.xlsx\n\n## Premier coup d'oeil\n\nVoyons d'abord plus en détails ce que nous avons comme données.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_energy <- as_tibble(read_csv(file = fpath_energy))\n\ndata_life <- as_tibble(read_excel(fpath_life, sheet = \"data-for-countries-etc-by-year\", range = NULL, trim_ws = TRUE, col_names = TRUE))\n```\n:::\n\n\n### Énergie\n\n\n::: {.cell}\n\n```{.r .cell-code}\nkable(slice_sample(data_energy, n = 5))\n```\n\n::: {.cell-output-display}\n|country    | year|iso_code | population|          gdp| biofuel_cons_change_pct| biofuel_cons_change_twh| biofuel_cons_per_capita| biofuel_consumption| biofuel_elec_per_capita| biofuel_electricity| biofuel_share_elec| biofuel_share_energy| carbon_intensity_elec| coal_cons_change_pct| coal_cons_change_twh| coal_cons_per_capita| coal_consumption| coal_elec_per_capita| coal_electricity| coal_prod_change_pct| coal_prod_change_twh| coal_prod_per_capita| coal_production| coal_share_elec| coal_share_energy| electricity_demand| electricity_generation| electricity_share_energy| energy_cons_change_pct| energy_cons_change_twh| energy_per_capita| energy_per_gdp| fossil_cons_change_pct| fossil_cons_change_twh| fossil_elec_per_capita| fossil_electricity| fossil_energy_per_capita| fossil_fuel_consumption| fossil_share_elec| fossil_share_energy| gas_cons_change_pct| gas_cons_change_twh| gas_consumption| gas_elec_per_capita| gas_electricity| gas_energy_per_capita| gas_prod_change_pct| gas_prod_change_twh| gas_prod_per_capita| gas_production| gas_share_elec| gas_share_energy| greenhouse_gas_emissions| hydro_cons_change_pct| hydro_cons_change_twh| hydro_consumption| hydro_elec_per_capita| hydro_electricity| hydro_energy_per_capita| hydro_share_elec| hydro_share_energy| low_carbon_cons_change_pct| low_carbon_cons_change_twh| low_carbon_consumption| low_carbon_elec_per_capita| low_carbon_electricity| low_carbon_energy_per_capita| low_carbon_share_elec| low_carbon_share_energy| net_elec_imports| net_elec_imports_share_demand| nuclear_cons_change_pct| nuclear_cons_change_twh| nuclear_consumption| nuclear_elec_per_capita| nuclear_electricity| nuclear_energy_per_capita| nuclear_share_elec| nuclear_share_energy| oil_cons_change_pct| oil_cons_change_twh| oil_consumption| oil_elec_per_capita| oil_electricity| oil_energy_per_capita| oil_prod_change_pct| oil_prod_change_twh| oil_prod_per_capita| oil_production| oil_share_elec| oil_share_energy| other_renewable_consumption| other_renewable_electricity| other_renewable_exc_biofuel_electricity| other_renewables_cons_change_pct| other_renewables_cons_change_twh| other_renewables_elec_per_capita| other_renewables_elec_per_capita_exc_biofuel| other_renewables_energy_per_capita| other_renewables_share_elec| other_renewables_share_elec_exc_biofuel| other_renewables_share_energy| per_capita_electricity| primary_energy_consumption| renewables_cons_change_pct| renewables_cons_change_twh| renewables_consumption| renewables_elec_per_capita| renewables_electricity| renewables_energy_per_capita| renewables_share_elec| renewables_share_energy| solar_cons_change_pct| solar_cons_change_twh| solar_consumption| solar_elec_per_capita| solar_electricity| solar_energy_per_capita| solar_share_elec| solar_share_energy| wind_cons_change_pct| wind_cons_change_twh| wind_consumption| wind_elec_per_capita| wind_electricity| wind_energy_per_capita| wind_share_elec| wind_share_energy|\n|:----------|----:|:--------|----------:|------------:|-----------------------:|-----------------------:|-----------------------:|-------------------:|-----------------------:|-------------------:|------------------:|--------------------:|---------------------:|--------------------:|--------------------:|--------------------:|----------------:|--------------------:|----------------:|--------------------:|--------------------:|--------------------:|---------------:|---------------:|-----------------:|------------------:|----------------------:|------------------------:|----------------------:|----------------------:|-----------------:|--------------:|----------------------:|----------------------:|----------------------:|------------------:|------------------------:|-----------------------:|-----------------:|-------------------:|-------------------:|-------------------:|---------------:|-------------------:|---------------:|---------------------:|-------------------:|-------------------:|-------------------:|--------------:|--------------:|----------------:|------------------------:|---------------------:|---------------------:|-----------------:|---------------------:|-----------------:|-----------------------:|----------------:|------------------:|--------------------------:|--------------------------:|----------------------:|--------------------------:|----------------------:|----------------------------:|---------------------:|-----------------------:|----------------:|-----------------------------:|-----------------------:|-----------------------:|-------------------:|-----------------------:|-------------------:|-------------------------:|------------------:|--------------------:|-------------------:|-------------------:|---------------:|-------------------:|---------------:|---------------------:|-------------------:|-------------------:|-------------------:|--------------:|--------------:|----------------:|---------------------------:|---------------------------:|---------------------------------------:|--------------------------------:|--------------------------------:|--------------------------------:|--------------------------------------------:|----------------------------------:|---------------------------:|---------------------------------------:|-----------------------------:|----------------------:|--------------------------:|--------------------------:|--------------------------:|----------------------:|--------------------------:|----------------------:|----------------------------:|---------------------:|-----------------------:|---------------------:|---------------------:|-----------------:|---------------------:|-----------------:|-----------------------:|----------------:|------------------:|--------------------:|--------------------:|----------------:|--------------------:|----------------:|----------------------:|---------------:|-----------------:|\n|Azerbaijan | 2020|AZE      |   10284952|           NA|                      NA|                      NA|                      NA|                  NA|                   0.000|                0.00|              0.000|                   NA|               534.865|                0.179|                    0|                0.907|            0.009|                0.000|             0.00|                   NA|                   NA|                   NA|              NA|           0.000|             0.005|              23.37|                  24.38|                   13.744|                 -1.811|                 -3.271|         17246.980|             NA|                 -1.106|                 -1.944|               2251.833|              23.16|                 16906.21|                  173.88|            94.996|              98.024|               4.899|               5.776|         123.668|            1480.804|           15.23|              12024.16|               8.048|              19.266|           25148.246|        258.648|         62.469|           69.717|                    13.04|               -31.653|                -1.316|             2.809|               104.035|              1.07|                   273.1|            4.389|              1.583|                    -27.558|                     -1.327|                  3.505|                    118.620|                   1.22|                      340.771|                 5.004|                   1.976|            -1.01|                        -4.322|                      NA|                      NA|                  NA|                       0|                   0|                        NA|                  0|                   NA|             -13.328|               -7.72|          50.202|             771.029|            7.93|              4881.145|              -7.812|             -34.519|           39606.977|        407.356|         32.527|           28.301|                        0.32|                        0.00|                                     0.0|                            2.399|                            0.008|                            0.000|                                        0.000|                             31.131|                       0.000|                                   0.000|                          0.18|               2370.453|                    177.384|                    -27.558|                     -1.327|                  3.505|                    118.620|                   1.22|                      340.771|                 5.004|                   1.976|                 6.335|                 0.007|             0.123|                 4.861|              0.05|                  12.002|            0.205|               0.07|               -8.824|               -0.025|            0.252|                9.723|             0.10|                 24.539|           0.410|             0.142|\n|Guatemala  | 2018|GTM      |   16850176| 127549980672|                      NA|                      NA|                      NA|                  NA|                 182.194|                3.07|             21.758|                   NA|               328.136|                   NA|                   NA|                   NA|               NA|              166.764|             2.81|                   NA|                   NA|                   NA|              NA|          19.915|                NA|              12.44|                  14.11|                       NA|                  2.667|                  2.524|          5765.943|          0.762|                     NA|                     NA|                291.392|               4.91|                       NA|                      NA|            34.798|                  NA|                  NA|                  NA|              NA|               0.000|            0.00|                    NA|                  NA|                  NA|                  NA|             NA|          0.000|               NA|                     4.63|                    NA|                    NA|                NA|               315.130|              5.31|                      NA|           37.633|                 NA|                         NA|                         NA|                     NA|                    545.988|                   9.20|                           NA|                65.202|                      NA|            -1.67|                       -13.424|                      NA|                      NA|                  NA|                       0|                   0|                        NA|                  0|                   NA|                  NA|                  NA|              NA|             124.628|            2.10|                    NA|                  NA|                  NA|                  NA|             NA|         14.883|               NA|                          NA|                        3.37|                                     0.3|                               NA|                               NA|                          199.998|                                       17.804|                                 NA|                      23.884|                                   2.126|                            NA|                837.380|                     97.157|                         NA|                         NA|                     NA|                    545.988|                   9.20|                           NA|                65.202|                      NA|                    NA|                    NA|                NA|                11.869|              0.20|                      NA|            1.417|                 NA|                   NA|                   NA|               NA|               18.991|             0.32|                     NA|           2.268|                NA|\n|Ecuador    | 1949|ECU      |    3369365|   8737760256|                      NA|                      NA|                      NA|                  NA|                      NA|                  NA|                 NA|                   NA|                    NA|                   NA|                   NA|                   NA|               NA|                   NA|               NA|                   NA|                   NA|                   NA|              NA|              NA|                NA|                 NA|                     NA|                       NA|                     NA|                     NA|                NA|             NA|                     NA|                     NA|                     NA|                 NA|                       NA|                      NA|                NA|                  NA|                  NA|                  NA|              NA|                  NA|              NA|                    NA|               2.830|               0.036|             389.603|          1.313|             NA|               NA|                       NA|                    NA|                    NA|                NA|                    NA|                NA|                      NA|               NA|                 NA|                         NA|                         NA|                     NA|                         NA|                     NA|                           NA|                    NA|                      NA|               NA|                            NA|                      NA|                      NA|                  NA|                      NA|                  NA|                        NA|                 NA|                   NA|                  NA|                  NA|              NA|                  NA|              NA|                    NA|               0.000|               0.000|            1166.671|          3.931|             NA|               NA|                          NA|                          NA|                                      NA|                               NA|                               NA|                               NA|                                           NA|                                 NA|                          NA|                                      NA|                            NA|                     NA|                         NA|                         NA|                         NA|                     NA|                         NA|                     NA|                           NA|                    NA|                      NA|                    NA|                    NA|                NA|                    NA|                NA|                      NA|               NA|                 NA|                   NA|                   NA|               NA|                   NA|               NA|                     NA|              NA|                NA|\n|Tunisia    | 1949|TUN      |    3546337|           NA|                      NA|                      NA|                      NA|                  NA|                      NA|                  NA|                 NA|                   NA|                    NA|                   NA|                   NA|                   NA|               NA|                   NA|               NA|              -33.803|               -0.075|               41.539|           0.147|              NA|                NA|                 NA|                     NA|                       NA|                     NA|                     NA|                NA|             NA|                     NA|                     NA|                     NA|                 NA|                       NA|                      NA|                NA|                  NA|                  NA|                  NA|              NA|                  NA|              NA|                    NA|                  NA|               0.000|               0.000|          0.000|             NA|               NA|                       NA|                    NA|                    NA|                NA|                    NA|                NA|                      NA|               NA|                 NA|                         NA|                         NA|                     NA|                         NA|                     NA|                           NA|                    NA|                      NA|               NA|                            NA|                      NA|                      NA|                  NA|                      NA|                  NA|                        NA|                 NA|                   NA|                  NA|                  NA|              NA|                  NA|              NA|                    NA|                  NA|               0.000|               0.000|          0.000|             NA|               NA|                          NA|                          NA|                                      NA|                               NA|                               NA|                               NA|                                           NA|                                 NA|                          NA|                                      NA|                            NA|                     NA|                         NA|                         NA|                         NA|                     NA|                         NA|                     NA|                           NA|                    NA|                      NA|                    NA|                    NA|                NA|                    NA|                NA|                      NA|               NA|                 NA|                   NA|                   NA|               NA|                   NA|               NA|                     NA|              NA|                NA|\n|Comoros    | 2006|COM      |     604664|    888321664|                      NA|                      NA|                      NA|                  NA|                   0.000|                0.00|              0.000|                   NA|               750.000|                   NA|                   NA|                   NA|               NA|                0.000|             0.00|                   NA|                0.000|                0.000|           0.000|           0.000|                NA|               0.04|                   0.04|                       NA|                 16.382|                  0.102|          1194.371|          0.813|                     NA|                     NA|                 66.152|               0.04|                       NA|                      NA|           100.000|                  NA|                  NA|                  NA|              NA|               0.000|            0.00|                    NA|                  NA|               0.000|               0.000|          0.000|          0.000|               NA|                     0.03|                    NA|                    NA|                NA|                 0.000|              0.00|                      NA|            0.000|                 NA|                         NA|                         NA|                     NA|                      0.000|                   0.00|                           NA|                 0.000|                      NA|             0.00|                         0.000|                      NA|                      NA|                  NA|                       0|                   0|                        NA|                  0|                   NA|                  NA|                  NA|              NA|              66.152|            0.04|                    NA|                  NA|               0.000|               0.000|          0.000|        100.000|               NA|                          NA|                        0.00|                                     0.0|                               NA|                               NA|                            0.000|                                        0.000|                                 NA|                       0.000|                                   0.000|                            NA|                 66.152|                      0.722|                         NA|                         NA|                     NA|                      0.000|                   0.00|                           NA|                 0.000|                      NA|                    NA|                    NA|                NA|                 0.000|              0.00|                      NA|            0.000|                 NA|                   NA|                   NA|               NA|                0.000|             0.00|                     NA|           0.000|                NA|\n:::\n:::\n\n\nPremière question à se poser : Utiliserons-nous toutes ces variables?  \nSûrement pas, d'autant plus qu'il semble y avoir beaucoup d'informations manquantes. Nous y reviendrons...\n\n### Espérance de vie\n\n\n::: {.cell}\n\n```{.r .cell-code}\nkable(slice_sample(data_life, n = 5))\n```\n\n::: {.cell-output-display}\n|geo |name               | time| Life expectancy|\n|:---|:------------------|----:|---------------:|\n|deu |Germany            | 2007|           80.04|\n|dom |Dominican Republic | 2057|           79.16|\n|lao |Lao                | 1891|           31.60|\n|gnb |Guinea-Bissau      | 1942|           31.46|\n|lca |St. Lucia          | 1952|           53.17|\n:::\n:::\n\n\n\n\n## Nettoyage des données\n\nÀ première vue, les données semblent être bien arrangées et *tidy*. Rien de trop grave ne saute aux yeux. Uniformisons cependant les noms des colonnes entre les deux jeux de données en les nettoyant un peu par le fait même.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# renommer les titres de colonnes de data_life pour concorder avec ceux de data_energy\ndata_life_clean <- data_life %>%\n    dplyr::rename(life_expectancy = `Life expectancy`,\n                  year = `time`,\n                  country = `name`,\n                  iso_code = `geo`)\n```\n:::\n\n\nLes codes ISO des pays devraient aussi être uniformisés pour les avoir en majuscules dans les deux jeux.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# convertir les codes ISO du jeux data_life pour qu'ils soient en majuscules\n# inspiré de : https://stackoverflow.com/questions/16516593/convert-from-lowercase-to-uppercase-all-values-in-all-character-variables-in-dat\ndata_life_clean$iso_code <- toupper(data_life_clean$iso_code)\n```\n:::\n\n\n\n\n## Manipulations\n\nNous ne conserverons que les variables qui nous intéressent du jeux Energy. Nous nous attarderons donc seulement à l'énergie **consommée**.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_energy_cons <- data_energy %>%\n    select(iso_code,\n           country,\n           year,\n           population,\n           contains(\"cons\")\n           )\n\nkable(slice_sample(data_energy_cons, n = 5))\n```\n\n::: {.cell-output-display}\n|iso_code |country                | year| population| biofuel_cons_change_pct| biofuel_cons_change_twh| biofuel_cons_per_capita| biofuel_consumption| coal_cons_change_pct| coal_cons_change_twh| coal_cons_per_capita| coal_consumption| energy_cons_change_pct| energy_cons_change_twh| fossil_cons_change_pct| fossil_cons_change_twh| fossil_fuel_consumption| gas_cons_change_pct| gas_cons_change_twh| gas_consumption| hydro_cons_change_pct| hydro_cons_change_twh| hydro_consumption| low_carbon_cons_change_pct| low_carbon_cons_change_twh| low_carbon_consumption| nuclear_cons_change_pct| nuclear_cons_change_twh| nuclear_consumption| oil_cons_change_pct| oil_cons_change_twh| oil_consumption| other_renewable_consumption| other_renewables_cons_change_pct| other_renewables_cons_change_twh| primary_energy_consumption| renewables_cons_change_pct| renewables_cons_change_twh| renewables_consumption| solar_cons_change_pct| solar_cons_change_twh| solar_consumption| wind_cons_change_pct| wind_cons_change_twh| wind_consumption|\n|:--------|:----------------------|----:|----------:|-----------------------:|-----------------------:|-----------------------:|-------------------:|--------------------:|--------------------:|--------------------:|----------------:|----------------------:|----------------------:|----------------------:|----------------------:|-----------------------:|-------------------:|-------------------:|---------------:|---------------------:|---------------------:|-----------------:|--------------------------:|--------------------------:|----------------------:|-----------------------:|-----------------------:|-------------------:|-------------------:|-------------------:|---------------:|---------------------------:|--------------------------------:|--------------------------------:|--------------------------:|--------------------------:|--------------------------:|----------------------:|---------------------:|---------------------:|-----------------:|--------------------:|--------------------:|----------------:|\n|CIV      |Cote d'Ivoire          | 1948|    2510832|                      NA|                      NA|                      NA|                  NA|                   NA|                   NA|                   NA|               NA|                     NA|                     NA|                     NA|                     NA|                      NA|                  NA|                  NA|              NA|                    NA|                    NA|                NA|                         NA|                         NA|                     NA|                      NA|                      NA|                  NA|                  NA|                  NA|              NA|                          NA|                               NA|                               NA|                         NA|                         NA|                         NA|                     NA|                    NA|                    NA|                NA|                   NA|                   NA|               NA|\n|QAT      |Qatar                  | 1964|      57546|                      NA|                      NA|                      NA|                  NA|                   NA|                   NA|                   NA|               NA|                     NA|                     NA|                     NA|                     NA|                      NA|                  NA|                  NA|              NA|                    NA|                    NA|                NA|                         NA|                         NA|                     NA|                      NA|                      NA|                  NA|                  NA|                  NA|              NA|                          NA|                               NA|                               NA|                         NA|                         NA|                         NA|                     NA|                    NA|                    NA|                NA|                   NA|                   NA|               NA|\n|COG      |Congo                  | 1968|    1316130|                      NA|                      NA|                      NA|                  NA|                   NA|                   NA|                   NA|               NA|                     NA|                     NA|                     NA|                     NA|                      NA|                  NA|                  NA|              NA|                    NA|                    NA|                NA|                         NA|                         NA|                     NA|                      NA|                      NA|                  NA|                  NA|                  NA|              NA|                          NA|                               NA|                               NA|                         NA|                         NA|                         NA|                     NA|                    NA|                    NA|                NA|                   NA|                   NA|               NA|\n|VGB      |British Virgin Islands | 1997|      18610|                      NA|                      NA|                      NA|                  NA|                   NA|                   NA|                   NA|               NA|                 -0.261|                 -0.001|                     NA|                     NA|                      NA|                  NA|                  NA|              NA|                    NA|                    NA|                NA|                         NA|                         NA|                     NA|                      NA|                      NA|                  NA|                  NA|                  NA|              NA|                          NA|                               NA|                               NA|                      0.250|                         NA|                         NA|                     NA|                    NA|                    NA|                NA|                   NA|                   NA|               NA|\n|NA       |South America          | 2006|  376788418|                      NA|                      NA|                      NA|                  NA|               15.607|               34.475|              677.774|          255.377|                  4.114|                224.062|                  4.052|                143.787|                3692.316|               6.371|              69.515|        1160.605|                 4.555|                66.897|          1783.389|                      5.254|                     83.504|               1902.088|                  28.378|                  12.673|              58.636|               1.779|              39.797|        2276.334|                      58.985|                            6.353|                            3.523|                   5670.225|                      4.627|                     70.831|               1843.452|               -98.535|                -0.027|                 0|               69.638|                0.438|            1.078|\n:::\n:::\n\n\nDéjà beaucoup mieux, nous sommes passé de 129 à 45 variables. \nMais il y encore encore beaucoup de bruit, réduisons encore un peu plus.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_energy_cons <- data_energy_cons %>%\n    select(iso_code,\n           country,\n           year,\n           population,\n           contains(\"consumption\")\n           )\n\nkable(slice_sample(data_energy_cons, n = 5))\n```\n\n::: {.cell-output-display}\n|iso_code |country         | year| population| biofuel_consumption| coal_consumption| fossil_fuel_consumption| gas_consumption| hydro_consumption| low_carbon_consumption| nuclear_consumption| oil_consumption| other_renewable_consumption| primary_energy_consumption| renewables_consumption| solar_consumption| wind_consumption|\n|:--------|:---------------|----:|----------:|-------------------:|----------------:|-----------------------:|---------------:|-----------------:|----------------------:|-------------------:|---------------:|---------------------------:|--------------------------:|----------------------:|-----------------:|----------------:|\n|NA       |Eurasia (Shift) | 1981|         NA|                  NA|               NA|                      NA|              NA|                NA|                     NA|                  NA|              NA|                          NA|                         NA|                     NA|                NA|               NA|\n|DNK      |Denmark         | 1922|    3305392|                  NA|               NA|                      NA|              NA|                NA|                     NA|                  NA|              NA|                          NA|                         NA|                     NA|                NA|               NA|\n|JPN      |Japan           | 1910|   49058391|                  NA|               NA|                      NA|              NA|                NA|                     NA|                  NA|              NA|                          NA|                         NA|                     NA|                NA|               NA|\n|PRT      |Portugal        | 1908|    5777697|                  NA|               NA|                      NA|              NA|                NA|                     NA|                  NA|              NA|                          NA|                         NA|                     NA|                NA|               NA|\n|VEN      |Venezuela       | 1962|    8754089|                  NA|               NA|                      NA|              NA|                NA|                     NA|                  NA|              NA|                          NA|                         NA|                     NA|                NA|               NA|\n:::\n:::\n\n\nNous ajouterons aussi une variable *total_consumption* ainsi que *total_consumption_per_capita*.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# inspiré de : https://stackoverflow.com/questions/27354734/dplyr-mutate-rowsums-calculations-or-custom-functions\ndata_energy_cons <- data_energy_cons %>%\n    mutate(total_consumption = rowSums(across(biofuel_consumption:wind_consumption), \n                                       na.rm = TRUE))\n\ndata_energy_cons$total_consumption[data_energy_cons$total_consumption == 0.000] <- NA\n\ndata_energy_cons <- data_energy_cons %>%\n    mutate(total_consumption_per_capita = total_consumption / population)\n\nkable(slice_sample(data_energy_cons, n = 5))\n```\n\n::: {.cell-output-display}\n|iso_code |country       | year| population| biofuel_consumption| coal_consumption| fossil_fuel_consumption| gas_consumption| hydro_consumption| low_carbon_consumption| nuclear_consumption| oil_consumption| other_renewable_consumption| primary_energy_consumption| renewables_consumption| solar_consumption| wind_consumption| total_consumption| total_consumption_per_capita|\n|:--------|:-------------|----:|----------:|-------------------:|----------------:|-----------------------:|---------------:|-----------------:|----------------------:|-------------------:|---------------:|---------------------------:|--------------------------:|----------------------:|-----------------:|----------------:|-----------------:|----------------------------:|\n|THA      |Thailand      | 1932|   13340923|                  NA|               NA|                      NA|              NA|                NA|                     NA|                  NA|              NA|                          NA|                         NA|                     NA|                NA|               NA|                NA|                           NA|\n|ESP      |Spain         | 1917|   20811806|                  NA|               NA|                      NA|              NA|                NA|                     NA|                  NA|              NA|                          NA|                         NA|                     NA|                NA|               NA|                NA|                           NA|\n|NA       |North America | 1994|  448069901|                  NA|         5891.264|               24671.055|        6848.821|          1799.048|               4285.736|            2228.784|       11930.970|                     245.891|                  28995.771|               2056.952|             1.505|           10.508|         88966.305|                    0.0001986|\n|CHE      |Switzerland   | 2021|    8691409|                  NA|            1.014|                 140.422|          36.042|            95.132|                156.056|              46.528|         103.366|                       6.151|                    298.306|                109.528|             7.867|            0.378|          1000.790|                    0.0001151|\n|DZA      |Algeria       | 1988|   24243024|                  NA|           11.572|                 304.881|         194.136|             0.541|                  0.541|               0.000|          99.173|                       0.000|                    305.422|                  0.541|             0.000|            0.000|           916.807|                    0.0000378|\n:::\n:::\n\n\n::: callout-important\nNoter que la somme des observations contenant seulement des NA indiquait **0.000**.  \nNous avons préféré remplacer les sommes nulles par **NA**, jugeant qu'il semblait très peu probable que toutes les données soient à 0.000.\n:::\n\n### Ajout d'une variable *continents*\n\n> Pour ce faire, nous utiliserons le package de @countrycodepack\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_energy_cons_clean <- data_energy_cons %>%\n    mutate(countrycode(data_energy_cons$iso_code, origin = \"iso3c\", destination = \"continent\", custom_match = c( ATA = 'Antartica', ANT = 'Americas')), .before = 1) %>%\n    rename(continent = `countrycode(...)`)\n\nkable(slice_sample(data_energy_cons_clean, n = 10))\n```\n\n::: {.cell-output-display}\n|continent |iso_code |country                       | year| population| biofuel_consumption| coal_consumption| fossil_fuel_consumption| gas_consumption| hydro_consumption| low_carbon_consumption| nuclear_consumption| oil_consumption| other_renewable_consumption| primary_energy_consumption| renewables_consumption| solar_consumption| wind_consumption| total_consumption| total_consumption_per_capita|\n|:---------|:--------|:-----------------------------|----:|----------:|-------------------:|----------------:|-----------------------:|---------------:|-----------------:|----------------------:|-------------------:|---------------:|---------------------------:|--------------------------:|----------------------:|-----------------:|----------------:|-----------------:|----------------------------:|\n|NA        |NA       |Asia & Oceania (EIA)          | 1993|         NA|                  NA|               NA|                      NA|              NA|                NA|                     NA|                  NA|              NA|                          NA|                  24976.900|                     NA|                NA|               NA|         24976.900|                           NA|\n|Americas  |CUB      |Cuba                          | 2016|   11342012|                  NA|               NA|                      NA|              NA|                NA|                     NA|                  NA|              NA|                          NA|                     99.532|                     NA|                NA|               NA|            99.532|                    0.0000088|\n|Asia      |ISR      |Israel                        | 1957|    1688686|                  NA|               NA|                      NA|              NA|                NA|                     NA|                  NA|              NA|                          NA|                         NA|                     NA|                NA|               NA|                NA|                           NA|\n|Europe    |SRB      |Serbia                        | 1993|    7957074|                  NA|               NA|                      NA|              NA|                NA|                     NA|                  NA|              NA|                          NA|                         NA|                     NA|                NA|               NA|                NA|                           NA|\n|NA        |NA       |Lower-middle-income countries | 1979| 1551698522|                  NA|          697.792|                 2423.33|         297.801|           256.783|                265.400|               6.809|        1427.738|                       1.807|                   2688.730|                258.590|             0.000|            0.000|          8324.780|                    0.0000054|\n|Africa    |AGO      |Angola                        | 1927|    3163988|                  NA|               NA|                      NA|              NA|                NA|                     NA|                  NA|              NA|                          NA|                         NA|                     NA|                NA|               NA|                NA|                           NA|\n|Asia      |JPN      |Japan                         | 1954|   89093016|                  NA|               NA|                      NA|              NA|                NA|                     NA|                  NA|              NA|                          NA|                         NA|                     NA|                NA|               NA|                NA|                           NA|\n|NA        |NA       |G7 (Ember)                    | 2007|         NA|                  NA|               NA|                      NA|              NA|                NA|                     NA|                  NA|              NA|                          NA|                         NA|                     NA|                NA|               NA|                NA|                           NA|\n|Asia      |MMR      |Myanmar                       | 2005|   47724472|                  NA|               NA|                      NA|              NA|                NA|                     NA|                  NA|              NA|                          NA|                     78.402|                     NA|                NA|               NA|            78.402|                    0.0000016|\n|Americas  |CAN      |Canada                        | 1992|   28347644|                   0|          311.209|                 1928.26|         680.554|           931.968|               1173.466|             227.064|         936.497|                      14.253|                   3101.725|                946.402|             0.006|            0.174|         10251.578|                    0.0003616|\n:::\n:::\n\n\nUn message nous mentionne que deux codes ISO de pays n'ont pas trouvé d'équivalent, nous avons donc dû les ajouter manuellement dans la commande.\n\nAprès une analyse un peu plus poussée du jeu de données, nous constatons que la variable *country* correspond parfois à un pays et d'autres, à un continent ou région. Il serait donc préférable d'éliminer ces observations du jeu maintenant que nous avons ajouté la variable *continent*. \n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_energy_cons_clean <- data_energy_cons_clean %>%\n    filter(!is.na(continent))\n```\n:::\n\n\nLes pays sont donc maintenant associés aux continents suivants dans notre jeu de données :  \nAsia, Europe, Africa, Oceania, Antartica, Americas\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# html <- \"\"\n# \n# data_continents <- read_html(x = html) %>%\n#     html_element(css = \".data-table\") #%>% \n#     #html_table()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# quelques info utiles sur le fichier\n#file.info(fpath_energy)\n\n# paste avec le file.path quand on ouvre\n```\n:::\n\n\n\n\n\n\n\n## Sauvegarde de nos jeux de données nettoyés\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_csv(data_energy_cons_clean, file = \"data/processed/owid-energy-consumption-data.csv\")\nwrite_csv(data_life_clean, file = \"data/processed/gm-life-expectancy-data.csv\")\n```\n:::\n\n\nNous voilà maintenant avec nos deux jeux de données nettoyés que nous pourrons réutiliser :  \ndata/processed/gm-life-expectancy-data.csv, data/processed/owid-energy-consumption-data.csv\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}